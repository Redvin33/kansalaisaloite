/*! JsRender v1.0pre: http://github.com/BorisMoore/jsrender */
/*
* Optimized version of jQuery Templates, for rendering to string.
* Does not require jQuery, or HTML DOM
* Integrates with JsViews (http://github.com/BorisMoore/jsviews)
* Copyright 2012, Boris Moore
* Released under the MIT License.
*/
// informal pre beta commit counter: 21
(function(U,q,i){function N(a){this.name="JsRender Error";this.message=a||"JsRender error"}function V(a,c,b){if(!p.rTag||arguments.length)z=a?"\\"+a.charAt(0):z,w=a?"\\"+a.charAt(1):w,x=c?"\\"+c.charAt(0):x,s=c?"\\"+c.charAt(0):s,b=b?"\\"+b:W,p.rTag=A="(\\w*"+b+")?(?:(?:(\\w+(?=[\\/\\s"+x+"]))|(?:(\\w+)?(:)|(>)|(\\*)))\\s*((?:[^"+x+"]|"+x+"(?!"+s+"))*?)",A=RegExp(z+w+A+"(\\/)?|(?:\\/(\\w+)))"+x+s,"g"),X=RegExp("<.*>|([^\\\\]|^)[{}]|"+z+w+".*"+x+s);return[z,w,x,s,W]}function ca(a){var c=this,b=c.tmpl.helpers||
{},a=(c.dynCtx&&c.dynCtx[a]!==i?c.dynCtx:c.ctx[a]!==i?c.ctx:b[a]!==i?b:y[a]!==i?y:{})[a];return"function"!==typeof a?a:function(){return a.apply(c,arguments)}}function da(a,c,b,d){var b=!b.markup&&b||i,f=c.tmpl.converters;return(f=f&&f[a]||J[a])?f.call(c,d,b):(u("Unknown converter: {{"+a+":"),d)}function ea(a,c,b,d,f){var e,j=!b.markup&&b,m=j?j.view.tmpl:b,k=m.tags,l=m.templates,h=f.props=f.props||{},g=h.tmpl,B=5<arguments.length?fa.call(arguments,5):[],k=k&&k[a]||K[a];if(!k)return u("Unknown tag: {{"+
a+"}}"),"";d=d&&m.tmpls[d-1];g=g||d||k.template||i;f.view=c;g=f.tmpl=""+g===g?l&&l[g]||t[g]||t(g):g;f.attr=b.attr=b.attr||k.attr;f.tagName=a;f.renderContent=O;j&&(j.tagCtx={args:B,props:h,path:f.path,tag:k});k.render&&(e=k.render.apply(f,B));return e||(e==i?g?f.renderContent(B[0],i,c):"":e.toString())}function L(a,c,b,d,f,e,j,m){f={data:d,tmpl:f,views:m?[]:{},parent:b,ctx:a,path:c,_useKey:m?0:1,_onRender:j,_hlp:ca,renderLink:function(b){return this.tmpl.tmpls[b].render(d,a,this)}};b&&(c=b.views,b._useKey?
(c[f.key="_"+b._useKey++]=f,f.index=b.index):c.splice(f.key=f.index=e!==i?e:c.length,0,f));return f}function M(a,c,b,d,f){var e;if(b&&"object"===typeof b&&!b.nodeType){for(e in b)c(e,b[e]);return a}d===i&&(d=b,b=i);if(a=P.onBeforeStoreItem)f=a(c,b,d,f)||f;b?""+b===b&&(null===d?delete c[b]:c[b]=f?d=f(d,b):d):d=f?f(d):d;(a=P.onStoreItem)&&a(c,b,d,f);return d}function Y(a,c){a="function"===typeof a?{render:a}:a;a.name=c;a.is="tag";return a}function t(a,c){return M(this,t,a,c,Q)}function K(a,c){return M(this,
K,a,c,Y)}function y(a,c){return M(this,y,a,c)}function J(a,c){return M(this,J,a,c)}function O(a,c,b,d,f,e,j){var m,k,l,h,g,B,G="";d===v&&(k=v,d=0);if(this.tagName){h=this.tmpl;if(c||this.ctx)l={},this.ctx&&n(l,this.ctx),c&&n(l,c);c=l;if((g=this.props)&&g.link===D)c=c||{},c.link=D;b=b||this.view;e=e||this.path;d=d||this.key;j=b&&b._onRender}else h=this.jquery&&(this[0]||u('Unknown template: "'+this.selector+'"'))||this,j=j||b&&b._onRender;if(h){b?(l=b.ctx,m=b.dynCtx,a===b&&(a=b.data,f=v)):l=y;B=c&&
c!==l;if(m||B)l=n({},l),B&&n(l,c),m&&n(l,m);c=l;h.fn||(h=t[h]||t(h));if(h){j=c.link!==D&&j;if(r.isArray(a)&&!f){k=k?b:d!==i&&b||L(c,e,b,a,h,d,j,v);b=0;for(f=a.length;b<f;b++)m=a[b],m=h.fn(m,L(c,e,k,m,h,(d||0)+b,j),p),G+=j?j(m,h,g):m}else k=k?b:L(c,e,b,a,h,d,j),k._onRender=j,G+=h.fn(a,k,p,ga);return j?j(G,h,g,k.key,e):G}}u("No template found");return""}function ga(a){return a}function u(a){if(p.debugMode)throw new p.Error(a);}function I(a){u("Syntax error\n"+a)}function Z(a,c,b){function d(b){(b-=
k)&&h.push(a.substr(k,b).replace(ha,"\\n"))}function f(b){b&&I('Unmatched or missing tag: "{{/'+b+'}}" in template:\n'+a)}var e,j=c&&c.allowCode,m=[],k=0,l=[],h=m,g=[,,,m],a=a.replace(ia,"\\$1");f(l[0]&&l[0][3].pop()[0]);a.replace(A,function(c,m,i,n,r,p,t,E,x,q,C){p&&(r=":",n="html");var u="",s="",p=!x&&!r&&!b,i=i||r;d(C);k=C+c.length;if(t)j&&h.push(["*",E.replace(ja,"$1")]);else if(i){"else"===i?(g[5]=a.substring(g[5],C),g=l.pop(),h=g[3],p=v):m&&(l.push(g),g=["!",,,[],,C],h.push(g),h=g[3]);if(E)var H=
E,z,w={},F=0,y=D,A=D,H=(H+" ").replace(ka,function(a,c,d,e,f,g,j,k,h,l,i,n,p,u,r,q){function B(a,b,c,d,e,f,g){return b?(b=(c?'view._hlp("'+c+'")':d?"view":"data")+(g?(e?"."+e:c?"":d?"":"."+b)+(f||""):(g=c?"":d?e||"":b,"")),a=g?"."+g:"",s||(b+=a),b="view.data"===b.slice(0,9)?b.slice(5):b,s&&(b="b("+b+',"'+g+'")'+a),b):a}var d=d||c||i,e=e||k,h=h||r||"",f=f||""||"",s=(b||m)&&"("!==h;if(g)I(H);else return A?(A=!n,A?a:'"'):y?(y=!p,y?a:'"'):(d?(F++,d):"")+(q?F?"":z?(z=D,"\b"):",":j?(F&&I(H),z=v,"\b"+e+
":"):e?e.replace(la,B)+(h?(w[++F]=v,h):f):f?f:u?(w[F--]=D,u)+(h?(w[++F]=v,h):""):l?(w[F]||I(H),","):c?"":(A=n,y=p,'"'))}),C=H.replace(ma,function(a,b,c){b?s+=c+",":u+=c+",";return""});else C="";E=C;u=u.slice(0,-1);E=E.slice(0,-1);e=[i,n||"",E,p&&[],"{"+(u?"props:{"+u+"},":"")+"data: data"+(s?",ctx:{"+s.slice(0,-1)+"}":"")+"}"];h.push(e);p?(l.push(g),g=e,g[5]=k):m&&(g[5]=a.substring(g[5],k),g=l.pop())}else q&&(i=g[0],f(q!==i&&!("if"===q&&"else"===i)&&i),g[5]=a.substring(g[5],C),"!"===i&&(g[5]=a.substring(g[5],
k),g=l.pop()),g=l.pop());f(!g&&q);h=g[3]});d(a.length);return R(m,c)}function R(a,c){var b,d,f,e,j,m,k,l,h,g,i,n,p,r,q,s=c?{allowCode:r=c.allowCode,debug:c.debug}:{},t=c&&c.tmpls;e=(f=a.length)?"":'"";';for(d=0;d<f;d++)b=a[d],""+b===b?e+='"'+b+'"+':(g=b[0],"*"===g?e=e.slice(0,d?-1:-3)+";"+b[1]+(d+1<f?"ret+=":""):(i=b[1],n=b[2],q=b[3],p=b[4],markup=b[5],"!"===g.slice(-1)?(b=S(markup,s,c,t.length),R(q,b),(g=/\s+[\w-]*\s*\=\s*\\['"]$/.exec(a[d-1]))&&u("'{{!' in attribute:\n..."+a[d-1]+"{{!...\nUse data-link"),
e+="view.renderLink("+t.length+")+",b.bound=v,b.fn.attr=g||"leaf",t.push(b)):(q&&(b=S(markup,s,c,t.length),R(q,b),t.push(b)),h=h||-1<p.indexOf("view"),e+=(":"===g?"html"===i?(m=v,"h("+n):i?(l=v,'c("'+i+'",view,this,'+n):(k=v,"((v="+n+')!=u?v:""'):(j=v,'t("'+g+'",view,this,'+(q?t.length:'""')+","+p+(n?",":"")+n))+")+")));e=na+(k?"v,":"")+(j?"t=j._tag,":"")+(l?"c=j._convert,":"")+(m?"h=j.converters.html,":"")+"ret; try{\n\n"+(s.debug?"debugger;":"")+(r?"ret=":"return ")+e.slice(0,-1)+";\n\n"+(r?"return ret;":
"")+"}catch(e){return j._err(e);}";try{e=new Function("data, view, j, b, u",e)}catch(w){I("Compiled template code:\n\n"+e,w)}c&&(c.fn=e);return e}function $(a,c,b){var d,f;if(a)for(d in a)f=a[d],f.is||(a[d]=c(f,d,b))}function Q(a,c,b,d){function f(a){if(""+a===a||0<a.nodeType){try{j=0<a.nodeType?a:!X.test(a)&&q&&q(a)[0]}catch(e){}j&&(a=t[j.getAttribute(aa)],a||(c=c||"_"+oa++,j.setAttribute(aa,c),a=Q(j.innerHTML,c,b,d),t[c]=a));return a}}var e,j,a=a||"";e=f(a);d=d||(a.markup?a:{});d.name=c;d.is="tmpl";
if(!e&&a.markup&&(e=f(a.markup)))if(e.fn&&(e.debug!==a.debug||e.allowCode!==a.allowCode))e=e.markup;if(e!==i)return c&&!b&&(T[c]=function(){return a.render.apply(a,arguments)}),e.fn||a.fn?e.fn&&(a=c&&c!==e.name?n(n({},e),d):e):(a=S(e,d,b,0),Z(e,a)),$(d.templates,Q,a),$(d.tags,Y),a}function S(a,c,b,d){function f(a){b[a]&&(e[a]=n(n({},b[a]),c[a]))}var c=c||{},e={markup:a,tmpls:[],links:[],render:O};b&&(b.templates&&(e.templates=n(n({},b.templates),c.templates)),e.parent=b,e.name=b.name+"["+d+"]",e.key=
d);n(e,c);b&&(f("templates"),f("tags"),f("helpers"),f("converters"));return e}function pa(a){return ba[a]||(ba[a]="&#"+a.charCodeAt(0)+";")}if(!(q&&q.views||U.jsviews)){var r,A,X,n,z="{",w="{",x="}",s="}",W="!",P={},D=!1,v=!0,la=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,ka=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,
ha=/\r?\n/g,ja=/\\(['"])/g,ia=/\\?(['"])/g,ma=/\x08(~)?([^\x08]+)\x08/g,oa=0,ba={"&":"&amp;","<":"&lt;",">":"&gt;"},aa="data-jsv-tmpl",na="var j=j||"+(q?"jQuery.":"js")+"views,",qa=/[\x00"&'<>]/g,fa=Array.prototype.slice,T={},p={jsviews:"v1.0pre",sub:P,debugMode:v,render:T,templates:t,tags:K,helpers:y,converters:J,delimiters:V,View:L,_convert:da,_err:function(a){return p.debugMode?"Error: "+(a.message||a)+". ":""},_tmplFn:Z,_tag:ea,error:u,Error:N};(N.prototype=Error()).constructor=N;q?(r=q,r.templates=
t,r.render=T,r.views=p,r.fn.render=O):(r=U.jsviews=p,r.extend=function(a,c){var b,a=a||{};for(b in c)a[b]=c[b];return a},r.isArray=Array&&Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)});n=r.extend;K({"if":function(){var a=this.view;a.onElse=function(c,b){for(var d=0,f=b.length;f&&!b[d++];)if(d===f)return"";a.onElse=i;c.path="";return c.renderContent(a)};return a.onElse(this,arguments)},"else":function(){var a=this.view;return a.onElse?a.onElse(this,arguments):
""},"for":function(){var a,c="",b=arguments,d=b.length;0===d&&(d=1);for(a=0;a<d;a++)c+=this.renderContent(b[a]);return c},"*":function(a){return a}});J({html:function(a){return a!=i?String(a).replace(qa,pa):""}});V()}})(this,this.jQuery);