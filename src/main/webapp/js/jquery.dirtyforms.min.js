if("undefined"==typeof jQuery)throw"jQuery Required";
(function(b){b.extend({DirtyForms:{debug:!1,message:"You've made changes on this page which aren't saved. If you leave you will lose these changes.",title:"Are you sure you want to do that?",dirtyClass:"dirty",listeningClass:"dirtylisten",ignoreClass:"ignoredirty",choiceContinue:!1,helpers:[],dialog:{refire:function(a){b.facebox(a)},fire:function(a,c){b.facebox("<h1>"+c+"</h1><p>"+a+'</p><p><a href="#" class="ignoredirty button medium red continue">Continue</a><a href="#" class="ignoredirty button medium cancel">Stop</a>')},bind:function(){var a=
function(a){return function(c){c.preventDefault();b(document).trigger("close.facebox");a(c)}};b("#facebox .cancel, #facebox .close, #facebox_overlay").click(a(h));b("#facebox .continue").click(a(i))},stash:function(){var a=b("#facebox");return""==b.trim(a.html())||"block"!=a.css("display")?!1:b("#facebox .content").clone(!0)},selector:"#facebox .content"},isDirty:function(){return b(":dirtylistening").dirtyForms("isDirty")},disable:function(){c.disabled=!0},choiceCommit:function(a){c.deciding&&(b(document).trigger("choicecommit.dirtyforms"),
b.DirtyForms.choiceContinue?i(a):h(a),b(document).trigger("choicecommitAfter.dirtyforms"))},isDeciding:function(){return c.deciding},decidingContinue:function(a){i(a)},decidingCancel:function(a){h(a)},dirtylog:function(a){d(a)}}});b.extend(b.expr[":"],{dirtylistening:function(a){return b(a).hasClass(b.DirtyForms.listeningClass)},dirty:function(a){return b(a).hasClass(b.DirtyForms.dirtyClass)}});var k={init:function(){var a=b.DirtyForms;d("Adding forms to watch");if(!c.exitBound){var e=top!==self;
"function"===typeof b(document).on?(b(document).on("click","a",f),b(document).on("submit","form",g),e&&(b(top.document).on("click","a",f),b(top.document).on("submit","form",g))):(b(document).delegate("a","click",f),b(document).delegate("form","submit",g),e&&(b(top.document).delegate("a","click",f),b(top.document).delegate("form","submit",g)));b(window).bind("beforeunload",j);e&&b(top.window).bind("beforeunload",j);c.exitBound=!0}return this.each(function(){b(this).is("form")&&(d("Adding form "+b(this).attr("id")+
" to forms to watch"),b(this).addClass(a.listeningClass),"function"===typeof b(document).on?(b(this).on("focus change","textarea,input:not([type='checkbox'],[type='radio'],[type='button'],[type='image'],[type='submit'],[type='reset'],[type='file'],[type='search'])",n),b(this).on("change","input[type='checkbox'],input[type='radio'],select",p),b(this).on("click","input[type='reset']",q)):(b(this).delegate("textarea,input:not([type='checkbox'],[type='radio'],[type='button'],[type='image'],[type='submit'],[type='reset'],[type='file'],[type='search'])",
"focus change",n),b(this).delegate("input[type='checkbox'],input[type='radio'],select","change",p),b(this).delegate("input[type='reset']","click",q)))})},isDirty:function(){var a=!1,e=this;if(c.disabled)return!1;if(r())return a=!0;this.each(function(){if(b(this).hasClass(b.DirtyForms.dirtyClass))return a=!0});b.each(b.DirtyForms.helpers,function(b,c){if("isDirty"in c&&c.isDirty(e)||"isNodeDirty"in c&&c.isNodeDirty(e))return a=!0});d("isDirty returned "+a);return a},setDirty:function(){d("setDirty called");
return this.each(function(){b(this).addClass(b.DirtyForms.dirtyClass).parents("form").addClass(b.DirtyForms.dirtyClass)})},setClean:function(){d("setClean called");c.focused={element:!1,value:!1};return this.each(function(){var a=this;b(a).removeClass(b.DirtyForms.dirtyClass);if(b(a).is("form"))b(a).find(":dirty").removeClass(b.DirtyForms.dirtyClass);else{var c=b(a).parents("form");0==c.find(":dirty").length&&c.removeClass(b.DirtyForms.dirtyClass)}b.each(b.DirtyForms.helpers,function(b,c){"setClean"in
c&&c.setClean(a)})})}};b.fn.dirtyForms=function(a){if(k[a])return k[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return k.init.apply(this,arguments);b.error("Method "+a+" does not exist on jQuery.dirtyForms")};b.fn.setDirty=function(){return this.dirtyForms("setDirty")};b.fn.isDirty=function(){return this.dirtyForms("isDirty")};b.fn.cleanDirty=function(){return this.dirtyForms("setClean")};var c=b.DirtyForms=b.extend({disabled:!1,exitBound:!1,formStash:!1,dialogStash:!1,
deciding:!1,decidingEvent:!1,currentForm:!1,hasFirebug:"console"in window&&"firebug"in window.console,hasConsoleLog:"console"in window&&"log"in window.console,focused:{element:!1,value:!1}},b.DirtyForms),q=function(){b(this).parents("form").dirtyForms("setClean")},p=function(){b(this).dirtyForms("setDirty")},n=function(){element=b(this);r()&&c.focused.element.dirtyForms("setDirty");c.focused.element=element;c.focused.value=element.val()},r=function(){return c.focused.element&&c.focused.element.val()!==
c.focused.value},d=function(a){b.DirtyForms.debug&&(a="[DirtyForms] "+a,c.hasFirebug?console.log(a):c.hasConsoleLog?window.console.log(a):alert(a))},s=function(){var a="";b.each(b.DirtyForms.helpers,function(b,c){"ignoreAnchorSelector"in c&&(0<a.length&&(a+=","),a+=c.ignoreAnchorSelector)});return a},f=function(a){b(this).is(s())||l(a)},g=function(a){c.currentForm=this;l(a)},j=function(a){var b=l(a);b&&!0!=c.doubleunloadfix&&(d("Before unload will be called, resetting"),c.deciding=!1);c.doubleunloadfix=
!0;setTimeout(function(){c.doubleunloadfix=!1},200);if("string"==typeof b){if(a=a||window.event)a.returnValue=b;return b}},l=function(a){d("Entering: Leaving Event fired, type: "+a.type+", element: "+a.target+", class: "+b(a.target).attr("class")+" and id: "+a.target.id);if("beforeunload"==a.type&&c.doubleunloadfix)return d("Skip this unload, Firefox bug triggers the unload event multiple times"),c.doubleunloadfix=!1;var e;if(!(e=b(a.target).hasClass(c.ignoreClass)))e=b(a.target).attr("target"),"string"===
typeof e&&(e=e.toLowerCase()),e="_blank"===e;if(e)return d("Leaving: Element has ignore class or has target='_blank'"),a.isDefaultPrevented()||m(),!1;if(c.deciding)return d("Leaving: Already in the deciding process"),!1;if(a.isDefaultPrevented())return d("Leaving: Event has been stopped elsewhere"),!1;if(!c.isDirty())return d("Leaving: Not dirty"),a.isDefaultPrevented()||m(),!1;if("submit"==a.type&&b(a.target).dirtyForms("isDirty"))return d("Leaving: Form submitted is a dirty form"),a.isDefaultPrevented()||
m(),!0;c.deciding=!0;c.decidingEvent=a;d("Setting deciding active");!1!==c.dialog&&(d("Saving dialog content"),c.dialogStash=c.dialog.stash(),d(c.dialogStash));b(document).trigger("defer.dirtyforms");if("beforeunload"==a.type)return d("Returning to beforeunload browser handler with: "+c.message),c.message;c.dialog&&(a.preventDefault(),a.stopImmediatePropagation(),b(a.target).is("form")&&0<b(a.target).parents(c.dialog.selector).length?(d("Stashing form"),c.formStash=b(a.target).clone(!0).hide()):c.formStash=
!1,d("Deferring to the dialog"),c.dialog.fire(b.DirtyForms.message,b.DirtyForms.title),c.dialog.bind())},h=function(a){a.preventDefault();b(document).trigger("decidingcancelled.dirtyforms");!1!==c.dialog&&!1!==c.dialogStash&&(d("Refiring the dialog with stashed content"),c.dialog.refire(c.dialogStash.html(),a));b(document).trigger("decidingcancelledAfter.dirtyforms");c.dialogStash=!1;c.deciding=c.currentForm=c.decidingEvent=!1},i=function(a){window.onbeforeunload=null;a.preventDefault();c.dialogStash=
!1;b(document).trigger("decidingcontinued.dirtyforms");a:switch(a=c.decidingEvent,b(document).trigger("beforeRefire.dirtyforms"),a.type){case "click":d("Refiring click event");var e=new jQuery.Event("click");b(a.target).trigger(e);if(!e.isDefaultPrevented()){a=b(a.target).closest("[href]");d("Sending location to "+a.attr("href"));location.href=a.attr("href");break a}break;default:d("Refiring "+a.type+" event on "+a.target),c.formStash?(d("Appending stashed form to body"),e=c.formStash,b("body").append(e)):
(e=b(a.target),e.is("form")||(e=e.closest("form"))),e.trigger(a.type)}c.deciding=c.currentForm=c.decidingEvent=!1},m=function(){d("Clearing the beforeunload event");b(window).unbind("beforeunload",j);window.onbeforeunload=null}})(jQuery);